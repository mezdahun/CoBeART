<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>CoBeArt — Live Tracking Debug</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Socket.IO client served by the server automatically at /socket.io/socket.io.js -->
    <style>
      html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        width: 100%;
        background: black; /* optional, avoids white borders while loading */
      }
      #fluidFrame {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border: none;
        display: block;
      }
    </style>
  </head>
  <body>
    <h1>CoBeArt — Live Tracking Debug</h1>
    <div class="row">
      <div class="badge">namespace: /viewer</div>
      <div class="badge">status: <span id="status">connecting…</span></div>
      <div class="badge">fps(rx): <span id="fps">0</span></div>
    </div>
    <pre id="out">{ waiting for data… }</pre>

    <script src="/socket.io/socket.io.js"></script>
    <script>
      const statusEl = document.getElementById("status");
      const out = document.getElementById("out");
      const fpsEl = document.getElementById("fps");

      window.viewerSocket = io("/viewer", { transports: ["websocket"] });
      const socket = window.viewerSocket;

      let count = 0, lastTs = performance.now();
      function tickFPS() {
        const now = performance.now();
        if (now - lastTs >= 1000) {
          fpsEl.textContent = String(count);
          count = 0; lastTs = now;
        }
        requestAnimationFrame(tickFPS);
      }
      tickFPS();

      socket.on("connect", () => statusEl.textContent = "connected");
      socket.on("disconnect", () => statusEl.textContent = "disconnected");

      socket.on("frame", (payload) => {
        count++;
        // Pretty-print with limited size to avoid locking UI for huge payloads
        out.textContent = JSON.stringify(payload, null, 2);
      });
    </script>
    <iframe
      id="fluidFrame"
      src="/fluid/index.html">
    </iframe>
    <script src="/fluid-bridge.js"></script>

  </body>
</html>